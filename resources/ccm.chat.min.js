/**
 * @overview ccm component for simple chats
 * @author Andr√© Kless <andre.kless@web.de> 2016
 */
ccm.component({name:"chat",config:{html:[ccm.store,{local:"http://akless.github.io/ccm-developer/resources/ccm.chat.templates.min.json"}],key:"test",store:[ccm.store,{url:"ws://ccm2.inf.h-brs.de/index.js",store:"chat"}],style:[ccm.load,"http://akless.github.io/ccm-developer/resources/ccm.chat.style.min.css"],user:[ccm.instance,"https://kaul.inf.h-brs.de/ccm/components/user.js"]},Instance:function(){var e=this;e.init=function(t){e.store.onChange=function(){e.render()},t()},e.render=function(t){var c=ccm.helper.element(e);e.store.get(e.key,function(s){function n(s){c.html(ccm.helper.html(e.html.get("main")));for(var n=ccm.helper.find(e,".messages"),r=0;r<s.messages.length;r++){var m=s.messages[r];n.append(ccm.helper.html(e.html.get("message"),{name:ccm.helper.val(m.user),text:ccm.helper.val(m.text)}))}n.append(ccm.helper.html(e.html.get("input"),{onsubmit:function(){var t=ccm.helper.val(ccm.helper.find(e,"input").val()).trim();if(""!==t)return e.user.login(function(){s.messages.push({user:e.user.data().key,text:t}),e.store.set(s,function(){e.render()})}),!1}})),t&&t()}null===s?e.store.set({key:e.key,messages:[]},n):n(s)})}}});